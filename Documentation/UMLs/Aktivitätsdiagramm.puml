@startuml
skinparam ActivityFontSize 11
skinparam ActivityDiamondFontSize 11

start

:updateParameters(newParams);

if (Strukturelle Änderung?) then (ja)
  :Parameter aktualisieren;
  :DistributionProvider initialisieren;
  partition Initialisierung {
    :State zurücksetzen;
    :ScandalScheduler zurücksetzen;
    :ImpactCalculator zurücksetzen;
    :Parteien initialisieren;
    :Wählerpopulation initialisieren;
    :Unterstützerzahlen neu berechnen;
  }
else (nein)
  :Parameter aktualisieren;
  :DistributionProvider initialisieren;
endif

:runSimulationStep() aufrufen;

partition "Simulationsschritt durchführen" {
  :Schrittzähler erhöhen;

  :Abgelaufene Skandale entfernen;

  if (Skandal soll auftreten UND\nmehr als 1 Partei?) then (ja)
    partition "Neuen Skandal auslösen" {
      :Echte Parteien filtern;
      :Zielpartei zufällig auswählen;
      :Zufälligen Skandal laden;
      :ScandalEvent erstellen;
      :Skandal zu State hinzufügen;
      :Skandalzähler der Partei erhöhen;
    }
  else (nein)
  endif

  :Akuten Druck für alle Parteien berechnen;

  :Recovery-Prozess für Parteien durchführen;

  :Wählerentscheidungen verarbeiten;
  note right
    Gibt Liste von
    VoterTransitions zurück
  end note

  :Unterstützerzahlen neu berechnen;
}

:VoterTransitions zurückgeben;

stop

@enduml
